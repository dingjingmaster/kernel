# 合成器类型

合成器有不同的类型，取决于它们在操作系统整体架构中扮演的角色。例如，系统合成器可用于启动系统、处理多用户切换、可能的控制台终端模拟器等。不同的合成器（会话合成器）将提供实际的桌面环境。不同类型的合成器有多种共存方式。

在本节中，我们将介绍三种依赖于 libwayland-server 的 Wayland 合成器。

## 系统合成器

系统合成器可以从早期启动一直运行到关机。它可以有效取代内核 vt 系统，并与系统图形化启动设置和多系统支持相结合。

系统合成器可以承载不同类型的会话合成器，并允许我们在多个会话之间切换（快速用户切换或安全/个人桌面切换）。

系统合成器的 Linux 实现通常会使用 libudev、egl、kms、evdev 和 cairo。

对于全屏客户端，系统合成器可以直接修改视频扫描输出地址，以便直接从客户端提供的缓冲区读取数据。

## 会话合成器

会话合成器负责单个用户会话。如果存在系统编译器，会话编译器将嵌套在系统编译器下运行。嵌套是可行的，因为协议是异步的；涉及嵌套时，往返的成本太高。如果没有系统编译器，会话编译器可直接在硬件上运行。

X 应用程序可以通过按需激活的无根 X 服务器在会话合成器下继续工作。

会话编译器的可能示例包括 
- gnome-shell
- moblin
- kwin
- kmscon
- rdp session
- 带有 X11 或 Wayland 后端的 Weston 是嵌套在另一个会话合成器中的会话合成器
- Wayland 下的全屏 X 会话

## 嵌入式合成器

X11 允许客户端嵌入其他客户端的窗口，或允许客户端将其他客户端渲染的像素图内容复制到自己的窗口中。这通常用于面板中的小程序、浏览器插件等。Wayland 并不直接允许这样做，但客户端可以在带外交流 GEM 缓冲区名称，例如使用 D-Bus 或面板启动小程序时的命令行参数。另一种方法是使用嵌套的 Wayland 实例。为此，Wayland 服务器必须是主机应用程序链接到的一个库。然后，主机应用程序将把 Wayland 服务器套接字名称传递给嵌入式应用程序，并需要实现 Wayland 合成界面。主机应用程序会将客户端表面合成为其窗口的一部分，即在网页或面板中。嵌套 Wayland 服务器的好处在于，它能提供嵌入式客户端通知主机有关缓冲区更新的请求，以及转发主机应用程序输入事件的机制。

这种设置的一个例子是 Firefox 将 Flash 播放器作为一种特殊用途的合成器嵌入其中。
