# DPDK涉及的内核模块简介

## IGB_UIO(igb_uio.ko)

### 功能

基于UIO（Userspace I/O）机制，将网卡硬件寄存器映射到用户态，使DPDK应用程序能直接访问硬件资源，绕过内核协议栈的开销。 

### 核心作用

- 中断旁路：拦截内核中断，避免中断处理延迟，通过轮询模式提升性能
- 零拷贝传输：用户态直接操作网卡缓冲区，减少内核与用户态间的数据复制
- 硬件资源映射：初始化时将网卡寄存器映射到用户空间，支持多网卡类型（如Intel i40e、ixgbe）

## VFIO(vfio-pci.ko)

### 功能

支持设备直通（PCI Passthrough），允许DPDK直接控制物理网卡或虚拟功能（VF），提升虚拟化场景下的性能。 

### 核心作用

- 设备直通：将网卡从内核驱动解绑，直接分配给用户态进程，避免内核协议栈干扰
- 安全隔离：通过IOMMU（输入输出内存管理单元）实现硬件资源的隔离访问

## KNI(rte_kni.ko)

### 功能

提供内核态与用户态的报文交换通道，支持DPDK应用程序与Linux内核协议栈的交互。 

### 核心作用

- 协议栈处理：将用户态接收的报文传递给内核协议栈（如TCP/IP处理），或将内核生成的报文转发到用户态
- 虚拟网口模拟：创建虚拟网口（如kni0），兼容传统网络工具（如ethtool）

## 驱动协同工作流程

### 初始化阶段

- 加载`igb_uio`或`vfio-pci`内核模块，解绑网卡原有驱动
- 通过`dpdk-devbind.py`脚本将网卡绑定到用户态驱动

### 运行阶段

- PMD驱动通过轮询接受/发送报文，利用大页内存和CPU亲和性优化性能
- 需要内核交互时候(如协议栈处理)，通过KNI模块传递报文
